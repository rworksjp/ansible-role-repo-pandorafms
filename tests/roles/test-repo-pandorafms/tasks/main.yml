---
- name: Check repo file
  file:
    path: /etc/yum.repos.d/artica_pandorafms.repo
    state: file

- name: Check repo's url (must be unchanged).
  ini_file:
    dest: /etc/yum.repos.d/artica_pandorafms.repo
    section: artica_pandorafms
    option: baseurl
    value: '{{ repo_pandorafms_repo_url }}'
    no_extra_spaces: yes
  register: result

- name: Assert check result
  assert:
    that:
      - not result|changed

- name: Check repo's enabled value (must be unchanged).
  ini_file:
    dest: /etc/yum.repos.d/artica_pandorafms.repo
    section: artica_pandorafms
    option: enabled
    value: '{% 1 if repo_pandorafms_repo_url else 0 %}'
    no_extra_spaces: yes
  register: result

- name: Assert check results
  assert:
    that:
      - not result|changed

- name: Install pandorafms_agent_unix package
  package:
    name: pandorafms_agent_unix
    state: present
